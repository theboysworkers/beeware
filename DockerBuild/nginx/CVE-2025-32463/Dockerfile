FROM theb0ys/base:latest

LABEL description="This is an image for a Web Server with Nginx, PHP-fpm. It includes sudo 1.9.4 CVE-2025-32463."

# Install nginx and PHP with common modules
RUN apt-get update && \
    apt-get install -y nginx php8.2-fpm php-mysql php-xml php-mbstring php-curl php-zip php-gd && \
    sudo build-essential libpam0g-dev libssl-dev gcc wget && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Install sudo from apt then compile sudo 1.9.14 from source code
RUN wget https://www.sudo.ws/dist/sudo-1.9.14.tar.gz && \
    tar xzf sudo-1.9.14.tar.gz && \
    cd sudo-1.9.14 && \
    ./configure --prefix=/usr/local && \
    make && \
    make install && \
    rm /bin/sudo /bin/sudoedit /bin/sudoreplay && \
    cp /usr/local/bin/sudo /bin && \
    cp /usr/local/bin/sudoreplay /bin && \
    cp /usr/local/bin/sudoedit /bin && \
    cd .. && \
    rm -rf sudo-1.9.14 sudo-1.9.14.tar.gz
